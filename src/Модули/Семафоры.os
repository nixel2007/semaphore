Перем СписокСемафоров;
Перем СамоСемафор;

Функция Получить(КлючСемафора, Счетчик = 1) Экспорт
	
	СамоСемафор.Захватить();
	
	Семафор = СписокСемафоров.Получить(КлючСемафора);
	Если Семафор = Неопределено Тогда
		Семафор = Новый Семафор(Счетчик);
		СписокСемафоров.Вставить(КлючСемафора, Семафор);
	КонецЕсли;

	СамоСемафор.Освободить();
	
	Возврат Семафор;
	
КонецФункции

СписокСемафоров = Новый Соответствие();
СамоСемафор = Новый Семафор(1);
